# Project: logs_analysis
#### By: Don Coffman
### Project 3 in Udacity's Full Stack Web Developer Nanodegree Program (2018)


## Description:
Project 3 is based on a linemode Python program which is an Internal Reporting Tool designed to be used by
a team supporting a newspaper site, providing insite into what the site's readers like. The User-facing newspaper
site and its PostgreSQL database already exist. The program is capable of generating the required Summary Report
text output through the LINUX Terminal shell window.

- The Python program accesses a pre-existing, populated PostgreSQL relational DB, residing on a
  locally-installed VirtualMachine (VM) VirtualBox/Vagrant LINUX environment. (_See Requirements / Prerequisistes, below_)
  - The existing 'news' DB consists of (3) tables:
    - 'authors'
    - 'articles'
    - 'log'

- The Summary Report answers the following (3) questions using SQL analysis of the 'news' DB:
  1. What are the most popular three articles of all time?
  2. Who are the most popular article authors of all time?
  3. On which days did more than 1% of requests lead to errors?




## Project Contents:
- **log_analysis.py**: Main Python program code file containing analysis-question-specific query functions, called in Main
    section, to generate formatted report output.

- **log_analysis_output.txt**: Summary Report output ASCII Text file generated by redirecting Program STDOUT > file, in the shell.

- **README.md**: (This) Project README file (GitHub Markdown)




## Requirements / Prerequisites:
- **Git Bash Shell**: Since use of the above program is intended to be performed in a LINUX-style terminal shell env, it is suggested
     that a shell such as this is installed locally.

- **Python 3.6xx** (Min) must be installed on the target system and the path to the interpreter should be included in environment variables.

- **VirtualBox** must be installed on the target system. (This is the software that runs the VirtualMachine session.)
  - Download installation through virtualbox.org:
    - https://www.virtualbox.org/wiki/Download_Old_Builds_5_1
      _Note: As of October 2017, the supported version of VirtualBox to install is version 5.1. Newer versions do not work with the
       current release of Vagrant._

- **Vagrant** must be installed on the target system. (This is the software that configures the VM environment and allows
      file sharing between your normal env and the new VM environment.)
  - Download installation through vagrantup.com:
    - https://www.vagrantup.com/downloads.html

- **VM Configuration** In order to correctly configure the VM env for this project and creation of the populated PostgreSQL
    'news' database that is required, download the Udacity VM Configuration dataset in one of the following ways:
    - Download the following FSND-Virtual-Machine zip file to the target machine and unzip it:
      - https://s3.amazonaws.com/video.udacity-data.com/topher/2018/April/5acfbfa3_fsnd-virtual-machine/fsnd-virtual-machine.zip
    - Alternatively, GitHub can be used to fork and clone the following repository:
      - https://github.com/udacity/fullstack-nanodegree-vm
    - As a results of the above, the following directory and sub-directory will be created on the target system:
      - **FSND-Virtual-Machine**
        - **vagrant**
          _Note: The 'vagrant' sub-directory is the main shared directory root accessible when the vagrant VM env is running.
             To ensure that the **logs_analysis.py** Python program file is accessible when the VM env is running, (not all
             local dirs are accessible) create the GitHub cloned / unzipped directory under the 'vagrant' sub-directory_
    - 'cd' to the 'vagrant' directory.
    - Execute the following command in the Shell to setup the VM env:
      - 'vagrant up'
    - After the above command has successfully completed, execute the following command in the Shell to startup the VM LINUX session:
      - 'vagrant ssh'
      _Note: - The PostgreSQL database engine and its functionality is only present in this env._

- **Download the data to build the 'news' PostgreSQL database** using this link:
  - https://d17h27t6h515a5.cloudfront.net/topher/2016/August/57b5f748_newsdata/newsdata.zip
  - You will need to unzip this file after downloading it. The file inside it is called 'newsdata.sql'. **Put this file into the vagrant directory,
    which is shared with your virtual machine.**

  - To create the 'news' DB and load the data into, cd into the vagrant directory and execute the following command:
    - **psql -d news -f newsdata.sql**
      - Here's what this command does:
        - **psql**    — the PostgreSQL command line program
        - **-d news** — connect to the database named news which has been set up for you
        - **-f newsdata.sql** — run the SQL statements in the file newsdata.sql
          Running this command will connect to your installed database server and execute the SQL commands in the downloaded file,
          creating tables and populating them with data.
      _Notes:_
        - The **psql** utility program is extremely helpful in investigating the DB, trying out SQL commands, etc.
           - To start the program up, execute **psql** in the shell. Type **help** to access the command line usage/help system.
        - If the 'news' database becomes corrupted, it can be restored through the following steps:
          - In 'psql', execute the following SQL commands:
          ```
            - DROP TABLE log;  (Note the required closing semicolon char (';') to execute the SQL commands ...)
            - DROP TABLE articles;
            - DROP TABLE authors;
          ```
            - Execute '\q' to exit 'psql'
            - Re-execute the original **psql -d news -f newsdata.sql** to repopulate the 'news' DB.

    - The following (5) custom database views are required by the **logs_analysis.py** program.
      - Start a 'psql' session connected to the 'news' DB, through the command:
        - **psql news**

      - Execute the following SQL commands in 'psql' to create the required views:
        ```

        CREATE VIEW req_by_day_all AS
          SELECT DATE_TRUNC('day'::text, time) AS date_trunc,
            COUNT(1) AS count_all
            FROM log
            GROUP BY 1
            ORDER BY 1;


        CREATE VIEW req_by_day_error AS
          SELECT DATE_TRUNC('day'::text, time) AS date_trunc,
            COUNT(1) AS count_error
            FROM log
            WHERE status NOT LIKE '%200%'
            GROUP BY 1
            ORDER BY 1;


        CREATE VIEW req_by_day_error_pct AS
          SELECT req_by_day_error.date_trunc,
            count_error,
            count_all,
            ROUND((100.0 * (count_error::numeric / count_all::numeric)), 1) AS pct_error
            FROM req_by_day_error INNER JOIN req_by_day_all
              ON req_by_day_error.date_trunc = req_by_day_all.date_trunc
            ORDER BY 1;


        CREATE VIEW articles_by_author AS
          SELECT name,
            authors.id,
            author,
            title,
            slug
            FROM authors INNER JOIN articles
              ON authors.id = articles.author;


        CREATE VIEW views_by_article AS
          SELECT path,
            slug
            FROM log INNER JOIN articles_by_author
              ON articles_by_author.slug = SUBSTR(log.path, 10);
        ```



## Installation:
- Clone this GitHub repository on local system
  -- OR --
- Download Zip File to local system and unzip



## Usage:
- Using local system command-line interface Shell:
  - Change directory to the above repo installation location (ie: relative to the '/vagrant' shared dir entry-point)
  - Execute the following:
    - **python logs_analysis.py**
  - The Summary Report output text will be displayed in the Terminal Shell display window.



## Contributions:
- The general layout of this README file is based on a template suggested by PhillipCoach in a Udacity Forum post
  and previously used/mentioned by Steven Wooding
- Some of the VM Installation/startup instructions are based on the Udacity Lesson/Project instructions.


## Extra Credit Changes Description:
- (5) custom Views were created in the 'news' DB and are used in the SQL DB queries executed by the 'log_analysis.py' program.
  - (2) sub-views, 'req_by_day_all' and 'req_by_day_error' are referenced by a 3rd higher-level view: 'req_by_day_error_pct'
    which is used in the actual SQL query call made by the program to answer Question No. 3.
